From 6f4ab4042244c08c4e7db9e097be59617df5c161 Mon Sep 17 00:00:00 2001
From: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Date: Thu, 20 Aug 2015 14:24:11 +0800
Subject: [PATCH] platform freescale t2080rdb u-boot

Add ONIE support for Freescale T2080RDB platform.

Signed-off-by: Shengzhou Liu <Shengzhou.Liu@freescale.com>
---
 configs/T2080RDB_ONIE_0_defconfig |  5 +++++
 include/configs/T208xRDB.h        | 31 +++++++++++++++++++++++++++++++
 2 files changed, 36 insertions(+)
 create mode 100644 configs/T2080RDB_ONIE_0_defconfig

diff --git a/configs/T2080RDB_ONIE_0_defconfig b/configs/T2080RDB_ONIE_0_defconfig
new file mode 100644
index 0000000..524c3ff
--- /dev/null
+++ b/configs/T2080RDB_ONIE_0_defconfig
@@ -0,0 +1,5 @@
+CONFIG_PPC=y
+CONFIG_MPC85xx=y
+CONFIG_TARGET_T208XRDB=y
+CONFIG_SYS_EXTRA_OPTIONS="PPC_T2080,ONIE,ONIE_PLATFORM_REV=0"
+CONFIG_SPI_FLASH=y
diff --git a/include/configs/T208xRDB.h b/include/configs/T208xRDB.h
index 8c637c2..6fd94d2 100644
--- a/include/configs/T208xRDB.h
+++ b/include/configs/T208xRDB.h
@@ -901,4 +901,35 @@ unsigned long get_board_ddr_clk(void);
 #undef CONFIG_CMD_USB
 #endif
 
+#ifdef CONFIG_ONIE
+/* Undefine those macros which are provided by common_config.h */
+#undef CONFIG_BOOTCOMMAND
+#undef CONFIG_SYS_PBSIZE
+#undef CONFIG_DOS_PARTITION
+#undef CONFIG_LOADS_ECHO
+#undef CONFIG_SYS_LOADS_BAUD_CHANGE
+#undef CONFIG_SYS_PCIE1_NAME
+#undef CONFIG_SYS_PCIE2_NAME
+#undef CONFIG_OF_LIBFDT
+#undef CONFIG_OF_BOARD_SETUP
+#undef CONFIG_OF_STDOUT_VIA_ALIAS
+#undef CONFIG_FIT
+#undef CONFIG_SYS_BAUDRATE_TABLE
+#undef CONFIG_EXTRA_ENV_SETTINGS
+
+#include "configs/common_config.h"
+
+/* Platform environment variables needed by the common env infrastructure */
+#define CONFIG_PLATFORM_ENV	\
+	"consoledev=ttyS0\0"	\
+	"onie_start=0xe8020000\0" \
+	"onie_sz.b=0x009e0000\0"  \
+	"hwconfig=fsl_ddr:ctlr_intlv=cacheline,bank_intlv=auto;" \
+	"usb1:dr_mode=host,phy_type=utmi\0"
+
+#define CONFIG_EXTRA_ENV_SETTINGS \
+	CONFIG_PLATFORM_ENV	  \
+	CONFIG_ONIE_COMMON_UBOOT_ENV
+#endif /* CONFIG_ONIE */
+
 #endif	/* __T2080RDB_H */
-- 
2.1.0.27.g96db324

